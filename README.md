# listenBilibili

使用B站作为音源的听歌工具。
A tool for listening music, use Bilibili source.

## 文档整理(draft)

计划将文档拆分成*使用手册*和*开发过程*两部分，因为手册需要程序基本完成才能开始写，所以可以先写在一起，到时候再整理和拆分。

## 为什么想做这样一个工具

随着一些标志性事件的发生，国内版权意识逐渐“觉醒”，但这个觉醒的版权可能和我的理解不太一样。

在我朴素的观念里，版权是保障原创作者权益的约定，比如代码库里的license。
但国内的版权，已经变成了保护获益人/资本的借口，举几个例子：

1. 《神探狄仁杰》核心制作人钱雁秋，因为所谓版权问题，在第4部作品中无法使用《神探狄仁杰4》作为名字，只能改用《神断狄仁杰》
2. 知名网络小说网站起点，签约合同中将小说作者创作内容的版权据为己有，使创作者变成了自带创意的枪手
3. 知名网络小说网站起点，在网站订阅作品，实际上只获得了15天的阅读权，15天之后，网站甚至可以随意删除你订阅的内容
4. 某知名主播因直播期间演唱某歌曲，被版权方索赔10万元，从此事件中还诞生了一批经典语句，如“索要的赔偿金额其实不重要，我们主要是希望唤起大家保护版权的意识”等

综上所述，“版权”原本神圣的光环，在我眼中逐渐褪色，我也不再重视任何我无法从中获益的版权问题。  
当然了，以上内容也可以解释成我为自己心安理得地看盗版小说、听无版权音乐找的借口，我也认可这种思路。

又因为我在一些场景中确实有听音乐的需求——比如做家务的时候，而现有音乐播放器或多或少都不符合我的情况：

1. 网易云、酷狗等播放器因为版权问题，部分歌曲直接没有，即使今天有的歌曲，可能明天就没了
2. [listen1](https://github.com/listen1/listen1_desktop)，我在使用期间经常遇到歌曲消失的情况：一首4分钟的歌，直接变成15s的“……请到酷我音乐手机端播放……”
3. B站，在一个100首歌的合集里找到一首自己不喜欢的歌可太简单了，B站听歌的问题在于up主上传什么、我就得听什么，没有办法跳过一首歌、修改播放顺序等

所以我产生了自己写一个听歌工具的想法，它应该有这些功能：

1. 能根据B站链接播放音频
2. 能显示歌词（可能会自己写歌词文件类型，或者使用.lrc）
3. 能操作歌单（计划配一个web页面，方便操作）

## 技术准备

我的核心需求是播放B站视频的音频部分，我准备先看看有没有现成的方法，如果没有，就根据B站视频的格式，找相关的播放方法。  
歌词准备自己写一个定时打印功能，一方面是我从网络上下载的.lrc文件，它的时间标注没有统一标准，有的到毫秒，有的只到秒；另一方面是功能不难，自己写更好修改。  
操作歌单就是比较进阶的需求了，可能会做一个网页吧，后面再说。

### 前期调研
网络上有一些下载视频或音频到本地的工具，但我不想下载，想在线播放。  
我找到了一种获取视频源的办法：模拟移动端调用，浏览器控制台-media，可以获取到可用的视频文件地址，可以在potplayer里直接播放。  
因为B站终归是视频网站，它没有道理把视频和音频拆开播放，那么我最开始设想的在线播放音频就不合适了。

为了方便描述，我们约定：

1. bv地址：
    - 形如`https://m.bilibili.com/video/BV1nk4y1P79g?p=22` 的链接
    - B站视频的公开地址
2. 源地址：
    - 形如
   ```text
   https://cn-hk-eq-01-14.bilivideo.com/upgcxcode/11/44/1190394411/1190394411-1-16.mp4
   ?e=ig8euxZM2rNcNbRVhwdVhwdlhWdVhwdVhoNvNC8BqJIzNbfq9rVEuxTEnE8L5F6VnEsSTx0vkX8fqJeYTj_lta53NCM=
   &uipk=5
   &nbs=1
   &deadline=1692035857
   &gen=playurlv2
   &os=bcache&oi=983052370
   &trid=00007c1bef8f8f0e424eb013d777b4aebf60h&mid=507453531
   &platform=html5
   &upsig=27967b89d0fa836e94ef28d0d279f9c4
   &uparams=e,uipk,nbs,deadline,gen,os,oi,trid,mid,platform
   &cdnid=68708&bvc=vod
   &nettype=0
   &bw=53263
   &logo=80000000
   ```
   的链接
    - B站视频源地址，可以直接通过potplayer等第三方播放器使用的地址

根据目前情况，整理解决方案流程：

1. 人工观看B站视频，找到一些好听的音源（这一步得到bv地址）
2. 获取视频源地址（模拟移动端调用上一步获得的地址，得到源地址）  
   可以看到源地址有一段`deadline`，像是请求时间+2h，并且经过尝试，只复制链接到.mp4是无法获取视频的  
   或许其他参数也有类似功能，所以我们需要在每次播放的时候都从bv地址请求一遍源地址
3. 播放视频源地址，目前有几个想法：调起第三方播放器、打开一个网页播放，或者可以找找有没有go写的mp4播放器  
   暂时计划打开一个网页播放视频，这样可以不用依赖第三方播放器，也因为我们本就计划写一个网页；  
   而且写网页还可以直接在网页上模拟移动端调用，go甚至可以只保存和传递歌单文件，剩下功能都在前端实现

### 编写demo

1. 编写go获取源地址demo，用go是因为我更熟悉
2. 编写网页播放视频demo
